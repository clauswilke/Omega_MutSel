/* 
Hyphy inference for an "experimental" dataset. Name of file indicates the mutation scheme.
Run across 8 sets of equilibrium freqs: Fequal, Fnull, F61_site, F3x4_site, CF3x4_site, F61_global, F3x4_global, CF3x4_global. 
NOTE: Fnull refers to frequencies which would exist in the absence of natural selection. 
*/


global w;
global k;
global t;

LIKELIHOOD_FUNCTION_OUTPUT = 1;
RANDOM_STARTING_PERTURBATIONS = 1;

/* Include relevant functions */
#include "matrices.mdl"; //rate matrices
#include "GY94_Header.ibf";

/* Read in the data */
DataSet	raw_data = ReadDataFile("temp.fasta");

/* Filter the data to find and remove any stop codons*/
DataSetFilter   filt_data = CreateFilter(raw_data,3,"", "","TAA,TAG,TGA");



/* Set up frequencies. MANY OF THESE WERE HARD-CODED IN WHEN THIS FILE WAS CREATED!!!*/

Fequal_CodonFreqs = {{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623}};

Fnull_CodonFreqs = {{0.0576983443548},{0.0178623287322},{0.0105319728082},{0.0678586010545},{0.0178623287322},{0.00552222202079},{0.00326287789486},{0.0209803898195},{0.0105319728082},{0.00326287789486},{0.0019163408744},{0.0123956892731},{0.0678586010545},{0.0209803898195},{0.0123956892731},{0.0797101896698},{0.016656776867},{0.00550938458351},{0.00301284076274},{0.0208985183277},{0.00550938458351},{0.00170636736722},{0.00100748665802},{0.00648261784471},{0.00301284076274},{0.00100748665802},{0.000495744452809},{0.00382119128245},{0.0208985183277},{0.00648261784471},{0.00382119128245},{0.0246286196663},{0.0110330778178},{0.00326881252872},{0.00201073890535},{0.0124138336682},{0.00326881252872},{0.00100886478209},{0.000596992336277},{0.00383288097333},{0.00201073890535},{0.000596992336277},{0.000358822780659},{0.00226728989147},{0.0124138336682},{0.00383288097333},{0.00226728989147},{0.0145619520645},{0.0210106323647},{0.0794524195248},{0.0210106323647},{0.00648393807125},{0.00385127114388},{0.0246314283336},{0.00385127114388},{0.00162336534621},{0.0145496436533},{0.0794524195248},{0.0246314283336},{0.0145496436533},{0.0935756891342}};

F61_CodonFreqs_site = DATAFREQS

F61_CodonFreqs_global = {{0.064733389149},{0.0189087927842},{0.0115632355352},{0.0720346808208},{0.0207617881406},{0.00656579480405},{0.00378655454002},{0.024940714433},{0.0183282358288},{0.00405567903695},{0.00328878996608},{0.0154654001066},{0.0608007675151},{0.0192542602696},{0.0132514010227},{0.0731046467845},{0.0191347680316},{0.00480231559218},{0.0034017780326},{0.0182508480802},{0.00493633324659},{0.00154560263115},{0.000894215786054},{0.00587706951851},{0.00512041822435},{0.0017083213866},{0.000887389890897},{0.00649153378304},{0.0213374201395},{0.00663029994479},{0.00386848498876},{0.0252850872804},{0.0124122552578},{0.00300126013449},{0.00220656490876},{0.0114319414507},{0.00510089124266},{0.00162307513157},{0.000932107751921},{0.00616737701312},{0.00292513578661},{0.000880222075102},{0.000507525132551},{0.00334915414632},{0.0125533738666},{0.00397240978366},{0.00229534552166},{0.015092184512},{0.0153368199285},{0.0580263918681},{0.0287298549736},{0.00881210127899},{0.00520928043386},{0.033507110926},{0.00341326527498},{0.00114878555926},{0.0129029488686},{0.0812743827376},{0.0190352784228},{0.0146973634242},{0.0724395752933}};

HarvestFrequencies(posFreqs,filt_data,3,1,1);
F3x4_CodonFreqs_site = BuildCodonFrequencies(posFreqs);
F3x4_CodonFreqs_global  = {{0.045984971},{0.015349081},{0.0087230298},{0.058339322},{0.023250312},{0.007760599},{0.0044104227},{0.029496755},{0.011738497},{0.0039181311},{0.0022267114},{0.014892169},{0.064896216},{0.021661366},{0.012310362},{0.082331275},{0.013893311},{0.0046373751},{0.0026354647},{0.017625897},{0.0070245519},{0.0023446882},{0.0013325087},{0.0089117725},{0.0035465195},{0.0011837741},{0.00067275013},{0.0044993297},{0.019606913},{0.0065444882},{0.0037192953},{0.024874519},{0.009013415},{0.0030085403},{0.0017097823},{0.011434965},{0.0045572435},{0.0015211383},{0.00086447745},{0.0057815954},{0.0023008375},{0.00076798444},{0.00043645291},{0.002918982},{0.012720167},{0.0042457977},{0.0024129275},{0.016137576},{0.01263039},{0.048006027},{0.019132123},{0.0063860105},{0.0036292309},{0.024272171},{0.003224136},{0.0018323074},{0.012254408},{0.053401537},{0.017824618},{0.010129901},{0.067748428}};

posFreqs_cf3x4 = CF3x4(posFreqs, "TAA,TAG,TGA");
CF3x4_CodonFreqs_site = BuildCodonFrequencies(posFreqs_cf3x4);
CF3x4_CodonFreqs_global = {{0.052352213},{0.014286011},{0.0095118677},{0.05430017},{0.02133986},{0.0058232779},{0.0038772368},{0.022133888},{0.012887426},{0.0035167553},{0.0023415151},{0.013366951},{0.059562505},{0.016253575},{0.010821905},{0.061778748},{0.015816659},{0.0043160921},{0.0028737271},{0.016405176},{0.0064472021},{0.0017593297},{0.0011713914},{0.006687094},{0.0038935514},{0.0010624827},{0.00070741892},{0.0040384253},{0.017995034},{0.0049105328},{0.0032695157},{0.018664606},{0.010261032},{0.0028000579},{0.0018643258},{0.010642832},{0.004182612},{0.0011413623},{0.00075993831},{0.0043382415},{0.0025259353},{0.00068928394},{0.00045893689},{0.002619922},{0.011674249},{0.0031857003},{0.0021210931},{0.012108633},{0.014792095},{0.056223761},{0.022095828},{0.0060295683},{0.0040145885},{0.022917984},{0.0036413368},{0.0024244636},{0.013840477},{0.061672516},{0.01682936},{0.011205272},{0.063967269}};


/* Optimize likelihoods for each frequency specification */

////////////// EQUAL FREQUENCIES //////////////
Model MyModel = (GY94, Fequal_CodonFreqs, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn = (filt_data, Tree01);
Optimize (paramValues, LikFn);
fprintf ("equal_hyout.txt", LikFn);


////////////// NULL FREQUENCIES //////////////
Model MyModel = (GY94, Fnull_CodonFreqs, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn1 = (filt_data, Tree01);
Optimize (paramValues, LikFn1);
fprintf ("null_hyout.txt", LikFn1);

////////////// DATA FREQUENCIES, SITE //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn2 = (filt_data, Tree01);
Optimize (paramValues, LikFn2);
fprintf ("f61_site_hyout.txt", LikFn2);

////////////// DATA FREQUENCIES, GLOBAL //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn3 = (filt_data, Tree01);
Optimize (paramValues, LikFn3);
fprintf ("f61_global_hyout.txt", LikFn3);



////////////// F3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn4 = (filt_data, Tree01);
Optimize (paramValues, LikFn4);
fprintf ("f3x4_site_hyout.txt", LikFn4);

////////////// F3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn5 = (filt_data, Tree01);
Optimize (paramValues, LikFn5);
fprintf ("f3x4_global_hyout.txt", LikFn5);


////////////// CF3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, CF3x4_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn6 = (filt_data, Tree01);
Optimize (paramValues, LikFn6);
fprintf ("cf3x4_site_hyout.txt", LikFn6);


////////////// CF3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, CF3x4_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn7 = (filt_data, Tree01);
Optimize (paramValues, LikFn7);
fprintf ("cf3x4_global_hyout.txt", LikFn7);

